FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGtleWNsb2FrLWFwYgpkZXNjcmlwdGlvbjogSWRlbnRpdHkgTWFu\
YWdlbWVudCAtIElkZW50aXR5IGFuZCBBY2Nlc3MgTWFuYWdlbWVudApiaW5kYWJsZTogVHJ1ZQph\
c3luYzogcmVxdWlyZWQKdGFnczogCiAgLSBtb2JpbGUtc2VydmljZQogIC0gbW9iaWxlLWNsaWVu\
dC1lbmFibGVkCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiAyLklkZW50aXR5IE1hbmFnZW1lbnQK\
ICBpbWFnZVVybDogImh0dHBzOi8vcGJzLnR3aW1nLmNvbS9wcm9maWxlX2ltYWdlcy83MDIxMTk4\
MjE5NzkzNDQ4OTcvb0FDMDVjRUJfNDAweDQwMC5wbmciCiAgZG9jdW1lbnRhdGlvblVybDogImh0\
dHBzOi8vZG9jcy5hZXJvZ2Vhci5vcmcvZXh0ZXJuYWwvYXBiL2tleWNsb2FrLmh0bWwiCiAgcHJv\
dmlkZXJEaXNwbGF5TmFtZTogIlJlZCBIYXQsIEluYy4iCiAgZGVwZW5kZW5jaWVzOgogICAgLSAi\
ZG9ja2VyLmlvL2pib3NzL2tleWNsb2FrLW9wZW5zaGlmdDozLjQuMy5GaW5hbCIKICAgIC0gImRv\
Y2tlci5pby9jZW50b3MvcG9zdGdyZXNxbC05Ni1jZW50b3M3OjkuNiIKICBzZGstZG9jcy1hbmRy\
b2lkOiAiaHR0cHM6Ly9kb2NzLmFlcm9nZWFyLm9yZy9leHRlcm5hbC9hcGIvaWRtL2FuZHJvaWQu\
aHRtbCIKICBzZGstZG9jcy1jb3Jkb3ZhOiAiaHR0cHM6Ly9kb2NzLmFlcm9nZWFyLm9yZy9leHRl\
cm5hbC9hcGIvaWRtL2NvcmRvdmEuaHRtbCIKICBzZGstZG9jcy1pb3M6ICJodHRwczovL2RvY3Mu\
YWVyb2dlYXIub3JnL2V4dGVybmFsL2FwYi9pZG0vaW9zLmh0bWwiCiAgc2RrLWRvY3MteGFtYXJp\
bjogImh0dHBzOi8vZG9jcy5hZXJvZ2Vhci5vcmcvZXh0ZXJuYWwvYXBiL2lkbS94YW1hcmluLmh0\
bWwiCiAgc2VydmljZU5hbWU6IGtleWNsb2FrCnBsYW5zOgogIC0gbmFtZTogZGVmYXVsdAogICAg\
ZGVzY3JpcHRpb246IERlcGxveSBrZXljbG9hawogICAgZnJlZTogVHJ1ZQogICAgbWV0YWRhdGE6\
CiAgICAgIG1vYmlsZWNsaWVudF9iaW5kX3BhcmFtZXRlcnNfZGF0YToKICAgICAgICAtICd7Im5h\
bWUiOiAiQ0xJRU5UX0lEIiwgInZhbHVlIjogIm1ldGFkYXRhLm5hbWUiLCAidHlwZSI6ICJwYXRo\
In0nCiAgICAgICAgLSAneyJuYW1lIjogIkNMSUVOVF9UWVBFIiwgInZhbHVlIjogInB1YmxpYyIs\
ICJ0eXBlIjogImRlZmF1bHQifScKICAgICAgc2VydmljZWluc3RhbmNlX2JpbmRfcGFyYW1ldGVy\
c19kYXRhOgogICAgICAgIC0gJ3sibmFtZSI6ICJDTElFTlRfSUQiLCAidmFsdWUiOiAibWV0YWRh\
dGEubmFtZSIsICJ0eXBlIjogInBhdGgifScKICAgICAgICAtICd7Im5hbWUiOiAiQ0xJRU5UX1RZ\
UEUiLCAidmFsdWUiOiAiYmVhcmVyIiwgInR5cGUiOiAiZGVmYXVsdCJ9JwogICAgcGFyYW1ldGVy\
czogCiAgICAtIG5hbWU6IFRBRwogICAgICByZXF1aXJlZDogVHJ1ZQogICAgICB0eXBlOiBzdHJp\
bmcKICAgIC0gbmFtZTogQURNSU5fVVNFUk5BTUUKICAgICAgcmVxdWlyZWQ6IFRydWUKICAgICAg\
ZGVmYXVsdDogYWRtaW4KICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBLZXljbG9hayBh\
ZG1pbiB1c2VybmFtZQogICAgLSBuYW1lOiBBRE1JTl9QQVNTV09SRAogICAgICByZXF1aXJlZDog\
VHJ1ZQogICAgICBkZWZhdWx0OiBhZG1pbgogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6\
IEtleWNsb2FrIGFkbWluIHBhc3N3b3JkCiAgICAtIG5hbWU6IENVU1RPTV9SRUFMTV9OQU1FCiAg\
ICAgIHJlcXVpcmVkOiBGYWxzZQogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IE5hbWUg\
b2YgdGhlIEtleWNsb2FrIHJlYWxtIChkZWZhdWx0cyB0byBjdXJyZW50IG5hbWVzcGFjZSkKICAg\
IC0gbmFtZTogVVNFX1NIQVJFRF9TRVJWSUNFCiAgICAgIHJlcXVpcmVkOiBGYWxzZQogICAgICB0\
eXBlOiBib29sCiAgICAgIHRpdGxlOiBDb25uZWN0IHRvIGFuIGV4aXN0aW5nIHNoYXJlZCBzZXJ2\
aWNlCiAgICAtIG5hbWU6IFNIQVJFRF9IT1NUCiAgICAgIHJlcXVpcmVkOiBGYWxzZQogICAgICB0\
eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IFVSTCBvZiB0aGUgc2hhcmVkIHNlcnZpY2UKICAgIGJp\
bmRfcGFyYW1ldGVyczoKICAgIC0gbmFtZTogQ0xJRU5UX0lECiAgICAgIHJlcXVpcmVkOiBUcnVl\
CiAgICAgIHRpdGxlOiBNb2JpbGUgY2xpZW50IElEL1NlcnZpY2UgSUQKICAgICAgdHlwZTogc3Ry\
aW5nCiAgICAtIG5hbWU6IENMSUVOVF9UWVBFCiAgICAgIHJlcXVpcmVkOiBUcnVlCiAgICAgIHRp\
dGxlOiBLZXljbG9hayBjbGllbnQgdHlwZQogICAgICB0eXBlOiBlbnVtCiAgICAgIGVudW06IFsn\
YmVhcmVyJywgJ3B1YmxpYyddCiAgICAgIGRlZmF1bHQ6IHB1YmxpYwo="


COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
COPY vars /opt/ansible/vars
RUN yum install epel-release -y && yum install jq -y
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -p /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb